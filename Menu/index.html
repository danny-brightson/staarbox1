<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Select Product</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="../Css/bootstrap.min.css">
<link rel="stylesheet" href="../Css/index.css">

<style>
/* ============================= */
/* STICKY HEADER */
/* ============================= */
.sticky-header{
  position: sticky;
  top: 0;
  z-index: 100;
  background: #f6f8fa;
  padding: 12px 0 8px;
}

/* ============================= */
/* CUSTOMER PILLS */
/* ============================= */
.customer-pill-bar{
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

.customer-pill{
  padding:10px 22px;
  border-radius:999px;
  border:1px solid #d0d5dd;
  background:#fff;
  font-weight:600;
  cursor:pointer;
  transition:.25s;
}

.customer-pill.active{
  background:#02614e;
  color:#fff;
  border-color:#02614e;
  box-shadow:0 0 0 4px rgba(2,97,78,.15);
}

.customer-pill.disabled{
  opacity:.4;
  pointer-events:none;
}

/* ============================= */
/* PROGRESS BAR */
/* ============================= */
.progress-wrapper{
  max-width:520px;
  margin:0 auto;
  text-align:center;
}

.progress-bar-container{
  height:10px;
  background:#e6eaf0;
  border-radius:999px;
  overflow:hidden;
}

.progress-bar-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#02614e,#04a777);
  transition:width .4s ease;
}

.progress-label{
  margin-top:6px;
  font-size:14px;
  font-weight:600;
  color:#02614e;
}

/* ============================= */
/* PRODUCT CARDS */
/* ============================= */
.category-card{
  cursor:pointer;
  transition:.3s ease;
}

.category-card.selected{
  outline:3px solid #02614e;
  transform:translateY(-6px);
  box-shadow:0 18px 35px rgba(0,0,0,.18);
}

/* NON-VEG UI */
.nonveg-ui{
  opacity:.45;
  filter:grayscale(100%);
  position:relative;
}

.nonveg-ui::after{
  content:"Contains Non-Veg";
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.85);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  color:#c0392b;
  border-radius:12px;
}

/* PRICE */
.menu-price{
  display:block;
  color:#02614e;
  font-weight:700;
  margin-top:6px;
}

/* CONTINUE */
.continue-btn{
  display:none;
  margin:50px auto 20px;
  padding:16px 50px;
  font-size:18px;
  font-weight:600;
  background:#02614e;
  color:#fff;
  border:0;
  border-radius:14px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

<h1 class="text-center fw-bold mt-4">Select Product</h1>

<!-- STICKY -->
<div class="sticky-header">
  <div class="customer-pill-bar" id="customerPillBar"></div>

  <div class="progress-wrapper">
    <div class="progress-bar-container">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
    <div class="progress-label" id="progressLabel"></div>
  </div>
</div>

<!-- PRODUCTS -->
<section class="category-section">
    <div class="category-grid">

      <div class="category-card" data-plan-id="basicfruitbowl" data-price="1699">
        <img src="../Menu/Basic fruit bowl.png">
        <h3>Elite Bowl</h3>
        <span class="menu-price">₹1699</span>
      </div>

      <div class="category-card" data-plan-id="standardfruitbowl" data-price="1199">
        <img src="../Menu/Basic fruit bowl.png">
        <h3>Essential Bowl</h3>
        <span class="menu-price">₹1199</span>
      </div>

      <div class="category-card" data-plan-id="kidbox" data-nonveg="true" data-price="2299">
        <img src="../Menu/kid box.png">
        <h3>Kid Box</h3>
        <span class="menu-price">₹2299</span>
      </div>
      
       <div class="category-card" data-nonveg="true" data-plan-id="standardbox" data-price="2829">
        <img src="../Menu/standard box.png">
        <h3>Standard Box</h3>
        <span class="menu-price">₹2829</span>
      </div>

        <div class="category-card" data-nonveg="true" data-plan-id="premiumbox" data-price="3499">
        <img src="../Menu/premium box.png">
        <h3>Premium Box</h3>
        <span class="menu-price">₹3499</span>
      </div>
      
      <div class="category-card" data-plan-id="kidvegbox" data-price="2299">
        <img src="../Menu/kid veg box.png">
        <h3>Kid Veg Box</h3>
        <span class="menu-price">₹2299</span>
      </div>

      <div class="category-card" data-plan-id="standardvegbox" data-price="2829">
        <img src="../Menu/standard veg box.png">
        <h3>Standard Veg Box</h3>
        <span class="menu-price">₹2829</span>
      </div>  

       <div class="category-card" data-plan-id="premiumvegbox" data-price="3499">
        <img src="../Menu/premium veg box.png">
        <h3>Premium Veg Box</h3>
        <span class="menu-price">₹3499</span>
      </div>

       <div class="category-card" data-plan-id="kidvegsandwichbox" data-price="2899">
        <img src="../Menu/kids veg sandwich.png">
        <h3>Kids Veg Sandwich</h3>
        <span class="menu-price">₹2899</span>
      </div>

        <div class="category-card" data-plan-id="standardvegsandwichbox" data-price="3739">
        <img src="../Menu/Standard veg sandwich.png">
        <h3>Standard Veg Sandwich Box</h3>
        <span class="menu-price">₹3739</span>
      </div>

      <div class="category-card" data-plan-id="premiumvegsandwichbox" data-price="4589">
        <img src="../Menu/preium veg sandwich.png">
        <h3>Premium Veg Sandwich Box</h3>
        <span class="menu-price">₹4589</span>
      </div>

        <div class="category-card" data-nonveg="true" data-plan-id="kidnonvegsandwichbox" data-price="3549">
        <img src="../Menu/Kids non veg sandwich .png">
        <h3>Kids Non-Veg Sandwich</h3>
        <span class="menu-price">₹3549</span>
      </div>

      <div class="category-card" data-nonveg="true" data-plan-id="standardnonvegsandwichbox" data-price="4069">
        <img src="../Menu/Standard nonveg sandwich.png">
        <h3>Standard Non-Veg Sandwich Box</h3>
        <span class="menu-price">₹4069</span>
      </div>

        <div class="category-card" data-nonveg="true" data-plan-id="premiumnonvegsandwichbox" data-price="4849">
        <img src="../Menu/Premium nonveg sandwich.png">
        <h3>Premium Non-Veg Sandwich Box</h3>
        <span class="menu-price">₹4849</span>
      </div>

    

    </div>
  </section>

<button class="continue-btn" id="continueBtn">Continue</button>

</div>

<script>
/* ============================= */
/* LOAD CUSTOMERS */
/* ============================= */
const customers = JSON.parse(
  localStorage.getItem("staarbox_customers") || "[]"
);

if (!customers.length) {
  alert("No customers found. Please enroll first.");
  window.location.href = "../Checkout/";
}

const pillBar = document.getElementById("customerPillBar");
const cards = document.querySelectorAll(".category-card");
const progressFill = document.getElementById("progressFill");
const progressLabel = document.getElementById("progressLabel");
const continueBtn = document.getElementById("continueBtn");

let activeIndex = 0;
const selections = Array(customers.length).fill(null);

/* ============================= */
/* CREATE PILLS */
/* ============================= */
customers.forEach((c, i) => {
  const pill = document.createElement("div");
  pill.className = "customer-pill";
  pill.textContent = c.name;
  pill.dataset.index = i;

  if (i === 0) pill.classList.add("active");
  else pill.classList.add("disabled");

  pill.onclick = () => {
    if (pill.classList.contains("disabled")) return;

    document.querySelectorAll(".customer-pill")
      .forEach(p => p.classList.remove("active"));

    pill.classList.add("active");
    activeIndex = i;

    applyVegRule();
    restoreSelection();
    updateProgress();
  };

  pillBar.appendChild(pill);
});

/* ============================= */
/* VEG RULE */
/* ============================= */
function applyVegRule(){
  const allowEgg = customers[activeIndex].isEggAllowed;

  cards.forEach(card=>{
    const isNonVeg = card.dataset.nonveg === "true";
    card.classList.toggle("nonveg-ui", !allowEgg && isNonVeg);
  });
}

/* ============================= */
/* PRODUCT SELECT */
/* ============================= */
cards.forEach(card=>{
  card.onclick = () => {
    if (card.classList.contains("nonveg-ui")) return;

    cards.forEach(c=>c.classList.remove("selected"));
    card.classList.add("selected");

    selections[activeIndex] = {
      customerId: customers[activeIndex].customerId,
      planId: card.dataset.planId,
      planName: card.querySelector("h3").innerText,
      price: Number(card.dataset.price)
    };

    const nextIndex = activeIndex + 1;
    const nextPill = document.querySelector(
      `.customer-pill[data-index="${nextIndex}"]`
    );

    updateProgress();

    if (nextPill) {
      nextPill.classList.remove("disabled");
      setTimeout(()=>{
        document.querySelectorAll(".customer-pill")
          .forEach(p=>p.classList.remove("active"));
        nextPill.classList.add("active");
        activeIndex = nextIndex;
        applyVegRule();
        restoreSelection();
        updateProgress();
      },250);
    }
  };
});

/* ============================= */
function restoreSelection(){
  cards.forEach(c=>c.classList.remove("selected"));
  const sel = selections[activeIndex];
  if (!sel) return;
  const card = [...cards].find(c=>c.dataset.planId === sel.planId);
  if (card) card.classList.add("selected");
}

/* ============================= */
function updateProgress(){
  const done = selections.filter(Boolean).length;
  const percent = (done / customers.length) * 100;

  progressFill.style.width = percent + "%";
  progressLabel.textContent = `${done} of ${customers.length} completed`;

  if (done === customers.length) {
    continueBtn.style.display = "block";
    setTimeout(()=>continueBtn.scrollIntoView({behavior:"smooth"}),300);
  } else {
    continueBtn.style.display = "none";
  }
}

/* ============================= */
continueBtn.onclick = () => {
  localStorage.setItem(
    "staarbox_selected_packages",
    JSON.stringify(selections)
  );
  window.location.href = "../Payment/";
};

/* INIT */
applyVegRule();
updateProgress();
</script>

</body>
</html>
